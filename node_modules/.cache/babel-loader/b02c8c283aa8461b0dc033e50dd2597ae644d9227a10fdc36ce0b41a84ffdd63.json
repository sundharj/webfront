{"ast":null,"code":"import{useParams,useNavigate}from\"react-router-dom\";import React,{useRef,useEffect,useState}from\"react\";import io from\"socket.io-client\";import{Container,Paper,Box,Button,Typography}from\"@mui/material\";// const socket = io(\"http://localhost:7001\");\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const socket=io(\"https://webback-1eh8.onrender.com\");const generateUserName=()=>`User-${Math.floor(Math.random()*10000)}`;const VideoCall=()=>{const{roomId,userName}=useParams();const ROOM_ID=roomId;const localVideoRef=useRef(null);const remoteVideoRef=useRef(null);const peerConnection=useRef(null);const iceCandidatesQueue=useRef([]);useEffect(()=>{socket.on(\"user-joined\",data=>{console.log(`${data.name} joined the room`);});socket.on(\"offer\",async _ref=>{let{offer}=_ref;if(!offer||!peerConnection.current||peerConnection.current.signalingState!==\"stable\")return;try{await peerConnection.current.setRemoteDescription(new RTCSessionDescription(offer));while(iceCandidatesQueue.current.length){const candidate=iceCandidatesQueue.current.shift();await peerConnection.current.addIceCandidate(new RTCIceCandidate(candidate));}if(peerConnection.current.signalingState===\"have-remote-offer\"){const answer=await peerConnection.current.createAnswer();await peerConnection.current.setLocalDescription(answer);socket.emit(\"answer\",{roomId:ROOM_ID,answer});}}catch(error){console.error(\"Error handling offer:\",error);}});socket.on(\"answer\",async _ref2=>{let{answer}=_ref2;if(!answer||!peerConnection.current||peerConnection.current.signalingState!==\"have-local-offer\")return;try{await peerConnection.current.setRemoteDescription(new RTCSessionDescription(answer));}catch(error){console.error(\"Error setting remote answer:\",error);}});socket.on(\"ice-candidate\",async _ref3=>{let{candidate}=_ref3;if(!candidate||!peerConnection.current)return;if(peerConnection.current.remoteDescription){await peerConnection.current.addIceCandidate(new RTCIceCandidate(candidate));}else{iceCandidatesQueue.current.push(candidate);}});return()=>{if(peerConnection.current){peerConnection.current.close();}};},[]);useEffect(()=>{socket.emit(\"join-room\",{roomId:ROOM_ID,userName});setupWebRTC();},[]);const setupWebRTC=async()=>{try{const stream=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:1920},height:{ideal:1080},frameRate:{ideal:30,max:60}},audio:{echoCancellation:true,noiseSuppression:true}});localVideoRef.current.srcObject=stream;peerConnection.current=new RTCPeerConnection({iceServers:[{urls:\"stun:stun.l.google.com:19302\"},{urls:\"turn:your.turn.server\",username:\"user\",credential:\"pass\"}]});stream.getTracks().forEach(track=>peerConnection.current.addTrack(track,stream));peerConnection.current.ontrack=event=>{remoteVideoRef.current.srcObject=event.streams[0];};peerConnection.current.onicecandidate=event=>{if(event.candidate){socket.emit(\"ice-candidate\",{roomId:ROOM_ID,candidate:event.candidate});}};}catch(error){console.error(\"Error accessing media devices:\",error);}};const createOffer=async()=>{if(!peerConnection.current)return;const offer=await peerConnection.current.createOffer();await peerConnection.current.setLocalDescription(offer);socket.emit(\"offer\",{roomId:ROOM_ID,offer});};return/*#__PURE__*/_jsx(Container,{maxWidth:\"md\",children:/*#__PURE__*/_jsxs(Paper,{elevation:3,sx:{p:3,textAlign:\"center\"},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h5\",gutterBottom:true,children:\"Video Call Room\"}),/*#__PURE__*/_jsxs(Box,{sx:{display:\"flex\",justifyContent:\"space-between\",alignItems:\"center\"},children:[/*#__PURE__*/_jsx(\"video\",{ref:localVideoRef,autoPlay:true,playsInline:true,muted:true,style:{width:\"48%\",borderRadius:\"8px\",background:\"black\",height:\"50vh\"}}),/*#__PURE__*/_jsx(\"video\",{ref:remoteVideoRef,autoPlay:true,playsInline:true,style:{width:\"48%\",borderRadius:\"8px\",background:\"black\",height:\"50vh\"}})]}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"primary\",sx:{mt:2},onClick:createOffer,children:\"Start Call\"})]})});};export default VideoCall;","map":{"version":3,"names":["useParams","useNavigate","React","useRef","useEffect","useState","io","Container","Paper","Box","Button","Typography","jsx","_jsx","jsxs","_jsxs","socket","generateUserName","Math","floor","random","VideoCall","roomId","userName","ROOM_ID","localVideoRef","remoteVideoRef","peerConnection","iceCandidatesQueue","on","data","console","log","name","_ref","offer","current","signalingState","setRemoteDescription","RTCSessionDescription","length","candidate","shift","addIceCandidate","RTCIceCandidate","answer","createAnswer","setLocalDescription","emit","error","_ref2","_ref3","remoteDescription","push","close","setupWebRTC","stream","navigator","mediaDevices","getUserMedia","video","width","ideal","height","frameRate","max","audio","echoCancellation","noiseSuppression","srcObject","RTCPeerConnection","iceServers","urls","username","credential","getTracks","forEach","track","addTrack","ontrack","event","streams","onicecandidate","createOffer","maxWidth","children","elevation","sx","p","textAlign","variant","gutterBottom","display","justifyContent","alignItems","ref","autoPlay","playsInline","muted","style","borderRadius","background","color","mt","onClick"],"sources":["C:/Users/sundh/OneDrive/Desktop/push/web/src/Home.js"],"sourcesContent":["\r\n\r\n\r\n\r\n\r\nimport { useParams, useNavigate } from \"react-router-dom\";\r\nimport React, { useRef, useEffect, useState } from \"react\";\r\nimport io from \"socket.io-client\";\r\nimport { Container, Paper, Box, Button, Typography } from \"@mui/material\";\r\n\r\n// const socket = io(\"http://localhost:7001\");\r\nconst socket = io(\"https://webback-1eh8.onrender.com\");\r\nconst generateUserName = () => `User-${Math.floor(Math.random() * 10000)}`;\r\n\r\nconst VideoCall = () => {\r\n  const { roomId, userName } = useParams();\r\n  const ROOM_ID = roomId;\r\n\r\n  const localVideoRef = useRef(null);\r\n  const remoteVideoRef = useRef(null);\r\n  const peerConnection = useRef(null);\r\n  const iceCandidatesQueue = useRef([]);\r\n\r\n  useEffect(() => {\r\n    socket.on(\"user-joined\", (data) => {\r\n      console.log(`${data.name} joined the room`);\r\n    });\r\n\r\n    socket.on(\"offer\", async ({ offer }) => {\r\n      if (!offer || !peerConnection.current || peerConnection.current.signalingState !== \"stable\") return;\r\n      try {\r\n        await peerConnection.current.setRemoteDescription(new RTCSessionDescription(offer));\r\n        while (iceCandidatesQueue.current.length) {\r\n          const candidate = iceCandidatesQueue.current.shift();\r\n          await peerConnection.current.addIceCandidate(new RTCIceCandidate(candidate));\r\n        }\r\n        if (peerConnection.current.signalingState === \"have-remote-offer\") {\r\n          const answer = await peerConnection.current.createAnswer();\r\n          await peerConnection.current.setLocalDescription(answer);\r\n          socket.emit(\"answer\", { roomId: ROOM_ID, answer });\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Error handling offer:\", error);\r\n      }\r\n    });\r\n\r\n    socket.on(\"answer\", async ({ answer }) => {\r\n      if (!answer || !peerConnection.current || peerConnection.current.signalingState !== \"have-local-offer\") return;\r\n      try {\r\n        await peerConnection.current.setRemoteDescription(new RTCSessionDescription(answer));\r\n      } catch (error) {\r\n        console.error(\"Error setting remote answer:\", error);\r\n      }\r\n    });\r\n\r\n    socket.on(\"ice-candidate\", async ({ candidate }) => {\r\n      if (!candidate || !peerConnection.current) return;\r\n      if (peerConnection.current.remoteDescription) {\r\n        await peerConnection.current.addIceCandidate(new RTCIceCandidate(candidate));\r\n      } else {\r\n        iceCandidatesQueue.current.push(candidate);\r\n      }\r\n    });\r\n\r\n    return () => {\r\n      if (peerConnection.current) {\r\n        peerConnection.current.close();\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    socket.emit(\"join-room\", { roomId: ROOM_ID, userName });\r\n    setupWebRTC();\r\n  }, []);\r\n\r\n  const setupWebRTC = async () => {\r\n    try {\r\n      const stream = await navigator.mediaDevices.getUserMedia({\r\n        video: { width: { ideal: 1920 }, height: { ideal: 1080 }, frameRate: { ideal: 30, max: 60 } },\r\n        audio: { echoCancellation: true, noiseSuppression: true }\r\n      });\r\n      localVideoRef.current.srcObject = stream;\r\n      peerConnection.current = new RTCPeerConnection({\r\n        iceServers: [\r\n          { urls: \"stun:stun.l.google.com:19302\" },\r\n          { urls: \"turn:your.turn.server\", username: \"user\", credential: \"pass\" }\r\n        ]\r\n      });\r\n      stream.getTracks().forEach(track => peerConnection.current.addTrack(track, stream));\r\n      peerConnection.current.ontrack = (event) => {\r\n        remoteVideoRef.current.srcObject = event.streams[0];\r\n      };\r\n      peerConnection.current.onicecandidate = (event) => {\r\n        if (event.candidate) {\r\n          socket.emit(\"ice-candidate\", { roomId: ROOM_ID, candidate: event.candidate });\r\n        }\r\n      };\r\n    } catch (error) {\r\n      console.error(\"Error accessing media devices:\", error);\r\n    }\r\n  };\r\n\r\n  const createOffer = async () => {\r\n    if (!peerConnection.current) return;\r\n    const offer = await peerConnection.current.createOffer();\r\n    await peerConnection.current.setLocalDescription(offer);\r\n    socket.emit(\"offer\", { roomId: ROOM_ID, offer });\r\n  };\r\n\r\n  return (\r\n    <Container maxWidth=\"md\">\r\n      <Paper elevation={3} sx={{ p: 3, textAlign: \"center\" }}>\r\n        <Typography variant=\"h5\" gutterBottom>\r\n          Video Call Room\r\n        </Typography>\r\n        <Box sx={{ display: \"flex\", justifyContent: \"space-between\", alignItems: \"center\" }}>\r\n          <video ref={localVideoRef} autoPlay playsInline muted style={{ width: \"48%\", borderRadius: \"8px\", background: \"black\", height: \"50vh\", }}></video>\r\n          <video ref={remoteVideoRef} autoPlay playsInline style={{ width: \"48%\", borderRadius: \"8px\", background: \"black\" , height: \"50vh\",}}></video>\r\n        </Box>\r\n        <Button variant=\"contained\" color=\"primary\" sx={{ mt: 2 }} onClick={createOffer}>\r\n          Start Call\r\n        </Button>\r\n      </Paper>\r\n    </Container>\r\n  );\r\n};\r\n\r\nexport default VideoCall;\r\n"],"mappings":"AAKA,OAASA,SAAS,CAAEC,WAAW,KAAQ,kBAAkB,CACzD,MAAO,CAAAC,KAAK,EAAIC,MAAM,CAAEC,SAAS,CAAEC,QAAQ,KAAQ,OAAO,CAC1D,MAAO,CAAAC,EAAE,KAAM,kBAAkB,CACjC,OAASC,SAAS,CAAEC,KAAK,CAAEC,GAAG,CAAEC,MAAM,CAAEC,UAAU,KAAQ,eAAe,CAEzE;AAAA,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBACA,KAAM,CAAAC,MAAM,CAAGV,EAAE,CAAC,mCAAmC,CAAC,CACtD,KAAM,CAAAW,gBAAgB,CAAGA,CAAA,GAAM,QAAQC,IAAI,CAACC,KAAK,CAACD,IAAI,CAACE,MAAM,CAAC,CAAC,CAAG,KAAK,CAAC,EAAE,CAE1E,KAAM,CAAAC,SAAS,CAAGA,CAAA,GAAM,CACtB,KAAM,CAAEC,MAAM,CAAEC,QAAS,CAAC,CAAGvB,SAAS,CAAC,CAAC,CACxC,KAAM,CAAAwB,OAAO,CAAGF,MAAM,CAEtB,KAAM,CAAAG,aAAa,CAAGtB,MAAM,CAAC,IAAI,CAAC,CAClC,KAAM,CAAAuB,cAAc,CAAGvB,MAAM,CAAC,IAAI,CAAC,CACnC,KAAM,CAAAwB,cAAc,CAAGxB,MAAM,CAAC,IAAI,CAAC,CACnC,KAAM,CAAAyB,kBAAkB,CAAGzB,MAAM,CAAC,EAAE,CAAC,CAErCC,SAAS,CAAC,IAAM,CACdY,MAAM,CAACa,EAAE,CAAC,aAAa,CAAGC,IAAI,EAAK,CACjCC,OAAO,CAACC,GAAG,CAAC,GAAGF,IAAI,CAACG,IAAI,kBAAkB,CAAC,CAC7C,CAAC,CAAC,CAEFjB,MAAM,CAACa,EAAE,CAAC,OAAO,CAAE,MAAAK,IAAA,EAAqB,IAAd,CAAEC,KAAM,CAAC,CAAAD,IAAA,CACjC,GAAI,CAACC,KAAK,EAAI,CAACR,cAAc,CAACS,OAAO,EAAIT,cAAc,CAACS,OAAO,CAACC,cAAc,GAAK,QAAQ,CAAE,OAC7F,GAAI,CACF,KAAM,CAAAV,cAAc,CAACS,OAAO,CAACE,oBAAoB,CAAC,GAAI,CAAAC,qBAAqB,CAACJ,KAAK,CAAC,CAAC,CACnF,MAAOP,kBAAkB,CAACQ,OAAO,CAACI,MAAM,CAAE,CACxC,KAAM,CAAAC,SAAS,CAAGb,kBAAkB,CAACQ,OAAO,CAACM,KAAK,CAAC,CAAC,CACpD,KAAM,CAAAf,cAAc,CAACS,OAAO,CAACO,eAAe,CAAC,GAAI,CAAAC,eAAe,CAACH,SAAS,CAAC,CAAC,CAC9E,CACA,GAAId,cAAc,CAACS,OAAO,CAACC,cAAc,GAAK,mBAAmB,CAAE,CACjE,KAAM,CAAAQ,MAAM,CAAG,KAAM,CAAAlB,cAAc,CAACS,OAAO,CAACU,YAAY,CAAC,CAAC,CAC1D,KAAM,CAAAnB,cAAc,CAACS,OAAO,CAACW,mBAAmB,CAACF,MAAM,CAAC,CACxD7B,MAAM,CAACgC,IAAI,CAAC,QAAQ,CAAE,CAAE1B,MAAM,CAAEE,OAAO,CAAEqB,MAAO,CAAC,CAAC,CACpD,CACF,CAAE,MAAOI,KAAK,CAAE,CACdlB,OAAO,CAACkB,KAAK,CAAC,uBAAuB,CAAEA,KAAK,CAAC,CAC/C,CACF,CAAC,CAAC,CAEFjC,MAAM,CAACa,EAAE,CAAC,QAAQ,CAAE,MAAAqB,KAAA,EAAsB,IAAf,CAAEL,MAAO,CAAC,CAAAK,KAAA,CACnC,GAAI,CAACL,MAAM,EAAI,CAAClB,cAAc,CAACS,OAAO,EAAIT,cAAc,CAACS,OAAO,CAACC,cAAc,GAAK,kBAAkB,CAAE,OACxG,GAAI,CACF,KAAM,CAAAV,cAAc,CAACS,OAAO,CAACE,oBAAoB,CAAC,GAAI,CAAAC,qBAAqB,CAACM,MAAM,CAAC,CAAC,CACtF,CAAE,MAAOI,KAAK,CAAE,CACdlB,OAAO,CAACkB,KAAK,CAAC,8BAA8B,CAAEA,KAAK,CAAC,CACtD,CACF,CAAC,CAAC,CAEFjC,MAAM,CAACa,EAAE,CAAC,eAAe,CAAE,MAAAsB,KAAA,EAAyB,IAAlB,CAAEV,SAAU,CAAC,CAAAU,KAAA,CAC7C,GAAI,CAACV,SAAS,EAAI,CAACd,cAAc,CAACS,OAAO,CAAE,OAC3C,GAAIT,cAAc,CAACS,OAAO,CAACgB,iBAAiB,CAAE,CAC5C,KAAM,CAAAzB,cAAc,CAACS,OAAO,CAACO,eAAe,CAAC,GAAI,CAAAC,eAAe,CAACH,SAAS,CAAC,CAAC,CAC9E,CAAC,IAAM,CACLb,kBAAkB,CAACQ,OAAO,CAACiB,IAAI,CAACZ,SAAS,CAAC,CAC5C,CACF,CAAC,CAAC,CAEF,MAAO,IAAM,CACX,GAAId,cAAc,CAACS,OAAO,CAAE,CAC1BT,cAAc,CAACS,OAAO,CAACkB,KAAK,CAAC,CAAC,CAChC,CACF,CAAC,CACH,CAAC,CAAE,EAAE,CAAC,CAENlD,SAAS,CAAC,IAAM,CACdY,MAAM,CAACgC,IAAI,CAAC,WAAW,CAAE,CAAE1B,MAAM,CAAEE,OAAO,CAAED,QAAS,CAAC,CAAC,CACvDgC,WAAW,CAAC,CAAC,CACf,CAAC,CAAE,EAAE,CAAC,CAEN,KAAM,CAAAA,WAAW,CAAG,KAAAA,CAAA,GAAY,CAC9B,GAAI,CACF,KAAM,CAAAC,MAAM,CAAG,KAAM,CAAAC,SAAS,CAACC,YAAY,CAACC,YAAY,CAAC,CACvDC,KAAK,CAAE,CAAEC,KAAK,CAAE,CAAEC,KAAK,CAAE,IAAK,CAAC,CAAEC,MAAM,CAAE,CAAED,KAAK,CAAE,IAAK,CAAC,CAAEE,SAAS,CAAE,CAAEF,KAAK,CAAE,EAAE,CAAEG,GAAG,CAAE,EAAG,CAAE,CAAC,CAC7FC,KAAK,CAAE,CAAEC,gBAAgB,CAAE,IAAI,CAAEC,gBAAgB,CAAE,IAAK,CAC1D,CAAC,CAAC,CACF3C,aAAa,CAACW,OAAO,CAACiC,SAAS,CAAGb,MAAM,CACxC7B,cAAc,CAACS,OAAO,CAAG,GAAI,CAAAkC,iBAAiB,CAAC,CAC7CC,UAAU,CAAE,CACV,CAAEC,IAAI,CAAE,8BAA+B,CAAC,CACxC,CAAEA,IAAI,CAAE,uBAAuB,CAAEC,QAAQ,CAAE,MAAM,CAAEC,UAAU,CAAE,MAAO,CAAC,CAE3E,CAAC,CAAC,CACFlB,MAAM,CAACmB,SAAS,CAAC,CAAC,CAACC,OAAO,CAACC,KAAK,EAAIlD,cAAc,CAACS,OAAO,CAAC0C,QAAQ,CAACD,KAAK,CAAErB,MAAM,CAAC,CAAC,CACnF7B,cAAc,CAACS,OAAO,CAAC2C,OAAO,CAAIC,KAAK,EAAK,CAC1CtD,cAAc,CAACU,OAAO,CAACiC,SAAS,CAAGW,KAAK,CAACC,OAAO,CAAC,CAAC,CAAC,CACrD,CAAC,CACDtD,cAAc,CAACS,OAAO,CAAC8C,cAAc,CAAIF,KAAK,EAAK,CACjD,GAAIA,KAAK,CAACvC,SAAS,CAAE,CACnBzB,MAAM,CAACgC,IAAI,CAAC,eAAe,CAAE,CAAE1B,MAAM,CAAEE,OAAO,CAAEiB,SAAS,CAAEuC,KAAK,CAACvC,SAAU,CAAC,CAAC,CAC/E,CACF,CAAC,CACH,CAAE,MAAOQ,KAAK,CAAE,CACdlB,OAAO,CAACkB,KAAK,CAAC,gCAAgC,CAAEA,KAAK,CAAC,CACxD,CACF,CAAC,CAED,KAAM,CAAAkC,WAAW,CAAG,KAAAA,CAAA,GAAY,CAC9B,GAAI,CAACxD,cAAc,CAACS,OAAO,CAAE,OAC7B,KAAM,CAAAD,KAAK,CAAG,KAAM,CAAAR,cAAc,CAACS,OAAO,CAAC+C,WAAW,CAAC,CAAC,CACxD,KAAM,CAAAxD,cAAc,CAACS,OAAO,CAACW,mBAAmB,CAACZ,KAAK,CAAC,CACvDnB,MAAM,CAACgC,IAAI,CAAC,OAAO,CAAE,CAAE1B,MAAM,CAAEE,OAAO,CAAEW,KAAM,CAAC,CAAC,CAClD,CAAC,CAED,mBACEtB,IAAA,CAACN,SAAS,EAAC6E,QAAQ,CAAC,IAAI,CAAAC,QAAA,cACtBtE,KAAA,CAACP,KAAK,EAAC8E,SAAS,CAAE,CAAE,CAACC,EAAE,CAAE,CAAEC,CAAC,CAAE,CAAC,CAAEC,SAAS,CAAE,QAAS,CAAE,CAAAJ,QAAA,eACrDxE,IAAA,CAACF,UAAU,EAAC+E,OAAO,CAAC,IAAI,CAACC,YAAY,MAAAN,QAAA,CAAC,iBAEtC,CAAY,CAAC,cACbtE,KAAA,CAACN,GAAG,EAAC8E,EAAE,CAAE,CAAEK,OAAO,CAAE,MAAM,CAAEC,cAAc,CAAE,eAAe,CAAEC,UAAU,CAAE,QAAS,CAAE,CAAAT,QAAA,eAClFxE,IAAA,UAAOkF,GAAG,CAAEtE,aAAc,CAACuE,QAAQ,MAACC,WAAW,MAACC,KAAK,MAACC,KAAK,CAAE,CAAEtC,KAAK,CAAE,KAAK,CAAEuC,YAAY,CAAE,KAAK,CAAEC,UAAU,CAAE,OAAO,CAAEtC,MAAM,CAAE,MAAQ,CAAE,CAAQ,CAAC,cAClJlD,IAAA,UAAOkF,GAAG,CAAErE,cAAe,CAACsE,QAAQ,MAACC,WAAW,MAACE,KAAK,CAAE,CAAEtC,KAAK,CAAE,KAAK,CAAEuC,YAAY,CAAE,KAAK,CAAEC,UAAU,CAAE,OAAO,CAAGtC,MAAM,CAAE,MAAO,CAAE,CAAQ,CAAC,EAC1I,CAAC,cACNlD,IAAA,CAACH,MAAM,EAACgF,OAAO,CAAC,WAAW,CAACY,KAAK,CAAC,SAAS,CAACf,EAAE,CAAE,CAAEgB,EAAE,CAAE,CAAE,CAAE,CAACC,OAAO,CAAErB,WAAY,CAAAE,QAAA,CAAC,YAEjF,CAAQ,CAAC,EACJ,CAAC,CACC,CAAC,CAEhB,CAAC,CAED,cAAe,CAAAhE,SAAS","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}